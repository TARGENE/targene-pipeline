# The Randomized Variants Workflow

In some interaction studies the variants are chosen based on a priori knowledge, typically they are QTLs. Consider two variants ``V_1`` and ``V_2``, that have been pre-identified to be eQTLs for a given gene's transcript. Then it makes sense to run a phenome-wide association study between these two variants because they potentially interact via the gene's transcript. This can be done via the [TarGene workflow](@ref "The TarGene Workflow") for instance and discoveries can be made. Because these two variants have been carefully chosen, replacing any of them for a random variant whose function is unknown should not result in an interaction. This is the basis of the randomized variants workflow.

!!! note
    By chance, one could pick a random variant also interacting with the other QTL. However, on average we should not deviate from the null hypothesis of no association. This can be checked via examination of the QQ plot generated by TarGene. This is addressed by selecting a certain number of random variants (`N_RANDOM_VARIANTS`) instead of 1.

## Example Run Command

```bash
nextflow run https://github.com/TARGENE/targene-pipeline/ -r TAG -entry RANDOMIZATION_TEST -profile P -resume
```

## Configuration

### Main Outputs

The workflow will produce the following output in the output directory (`OUTDIR`, defaults to `results`): an estimand file named "random_variants_estimands.jls". This can be further used by running a classic [TarGene workflow](@ref "The TarGene Workflow") with `STUDY_DESIGN=CUSTOM`.

### Arguments

- **`RESULTS_FILE` (required)**: Path to an HDF5 results file generated by a previous TarGene run.
- **`VARIANTS_TO_RANDOMIZE` (required)**: A text file containing the list of variants (one rsid per line) for which random candidates must be proposed.
- **`BGEN_FILES` (required)**: Path to imputed BGEN files from which the variants in `VARIANTS_TO_RANDOMIZE` will be found.

### Main Options

- **`N_RANDOM_VARIANTS` (optional, default: 10)**: The number of random variants to propose for each variant in `VARIANTS_TO_RANDOMIZE`.
- **`MAF_MATCHING_RELTOL` (optional, default: 0.05)**: Each proposed random variant should have the same minor allele frequency as the origin variant, up to a relative threshold.
- **`POSITIVITY_CONSTRAINT` (optional, default: 0.01)**: When the list of estimands is generated or validated. Treatment variables' rarest configuration should have at least that frequency. For example if the treatment variables are two variants with minor allele A and T respectively. The rarest configuration will be (AA, TT) and should have a frequency of at least `POSITIVITY_CONSTRAINT`.
- **`PVAL_THRESHOLD` (optional, default: 0.05)**: Only results with a p-value below this threshold are considered for permutation testing.
- **`ESTIMATOR_KEY` (optional, default: TMLE)**: The p-value for `PVAL_THRESHOLD` is computed using the result from this estimator.

### Secondary Options

- **`RNG` (optional, default: 123)**: General random seed used to induce permutation.
- **`VERBOSITY` (optional, default: 0)**: Verbosity level of the the Workflow's processes.
