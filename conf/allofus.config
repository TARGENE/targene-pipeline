process {
  executor = "google-lifesciences"

  withName: SVP {
    cpus = 30
    memory = '2000G'
    clusterOptions = { task.memory ? "-l mem_free=20G,h_vmem=${task.memory.bytes/task.cpus}" : null }
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/targeted-estimation:0.8"
  }

  withName: TMLE {
    memory = { 30.GB * task.attempt }
    time = { 48.hour * task.attempt }
    cpus = 2
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/targeted-estimation:0.8"
  }

  withName: filterBED {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/tl-core:0.8"
  }

  withName: thinByLD {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/plink2:0.1.0"
  }

  withName: mergeBEDS {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/tl-core:0.8"
  }

  withName: SampleQCFilter {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/plink2:0.1.0"
  }

  withName: FlashPCA {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/ktetleycampbell/flashpca:1.0"
  }

  withName: AdaptFlashPCA {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/tl-core:0.8"
  }

  withName: MakeDataset {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/tl-core:0.8"
  }

  withName: MergeOutputs {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/targeted-estimation:0.8"
  }

  withName: TMLEInputsFromParamFile {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/tl-core:0.8"
  }

  withName: TMLEInputsFromActors {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/tl-core:0.8"
  }

  withName: UKBFieldsList {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/ukbmain:0.4"
  }

  withName: UKBConv {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/ukbmain:0.4"
  }

  withName: TraitsFromUKB {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/ukbmain:0.4"
  }

  withName: GeneratePermutationTestsData {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/tl-core:0.8"
  }

  withName: GenerateRandomVariantsTestsData {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/tl-core:0.8"
  }

  withName: GenerateSummaryPlots {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/tl-core:0.8"
  }

  withName: GRMPart {
    container = "${ARTIFACT_REGISTRY_DOCKER_REPO}/olivierlabayle/tl-core:0.8"
  }
}

google {
    location = "us-central1"
    zone = "us-central1-a"
    enableRequesterPaysBuckets = true
}

